交易规则（日内短线优化版）：

1) 市场状态判定（降低门槛）：
   - 趋势条件（满足任一即可）：
     a) 1h EMA 排列一致（多头: fast > mid > slow，空头: 反向）且 4h EMA 方向与 1h 一致
     b) symbol 在 OTC API 列表 且 `period_quality` 高质量期
   - 不满足趋势条件 → 震荡模式
   - 方向优先级：1h 结构位（前高/前低）> 15m 触发信号

2) 趋势交易（顺势回调，日内优化）：
   - 入场条件（满足任一）：
     a) 15m `ema_fast.delta_pct` 回调至 mid 附近（-0.3% ~ 0.3%），且 1h 趋势未变
     b) 15m MACD histogram 收缩 2-3 根后开始扩张
     c) 15m `wt_mfi_hybrid` 从中性区回调至 oversold/overbought 边缘（-30 ~ -45 或 30 ~ 45）
   - 加仓条件：持仓方向与趋势一致，且新信号出现
   - 方向与止损锚点必须来自 1h 前高/前低的结构位

3) 震荡交易（日内反转，放宽条件）：
   - 基础条件（满足任一即可进入反转候选，非立即开仓）：
     a) `wt_mfi_hybrid` 进入超买/超卖区（15m: ±50，1h: ±50）
     b) `divergence_multi` 评分达到阈值的 35%（原 40%）
   - `divergence_multi` 方向解读：
     - `direction: "up"` = 看涨背离，考虑做多
     - `direction: "down"` = 看跌背离，考虑做空
     - `direction: "conflict"` = 观望，但可小仓位尝试
   - `direction: "none"` = 无背离信号
   - 评分放宽：阈值 = 活跃指标满分 × 35%

4) 收益/风险硬约束（必须计算）：
   - 止损锚点：1h 前低/前高（以结构位为准），风险 = |entry - stop|
   - 分批止盈加权 R/R：对每段止盈 reward = |target - entry|
     WeightedRR = Σ( reward_i * ratio_i ) / risk
   - ratio 来自 exit_plan 的 tp_tiers；若未给 ratio 则等权
   - 仓位必须按止损距离计算（以损订仓，优先使用系统计算的 position_size_usd）
   - 只有 WeightedRR >= 2 才允许正常出手
   - 1.5 <= WeightedRR < 2：允许，但必须标注“低置信/轻仓”
   - WeightedRR < 1.5 或无法计算：必须 HOLD（同时给出 watch_levels）
   - 杠杆必须按 ATR 计算并写入输出：
     a) max_atr_24h 优先用 1h `atr.range_max` 近似（若给出 1d 则用 1d）
     b) leverage = round(close / max_atr_24h)
     c) leverage 取整数，范围 [1, leverage.max]（若未给 max，默认 35）
     d) 若 ATR 数值缺失 → leverage=1 且标注“低置信”

5) 风控（日内适配）：
   - 单笔最大风险 = 净资产 3%（日内收紧）
   #- 日内最大持仓 2 笔
   - 止损触及立即平仓，不做对冲
   - 止盈/止损通过 exit_plan 输出

6) 信号优先级：
   - 趋势 + 回调 > 震荡反转 > 无明确信号
   - 宁可错过也不要勉强入场；不满足 R/R 或结构不清晰 → HOLD
   - 仅在满足 R/R 且结构明确时才给出建议

7) 条件单建议（无即时信号时必须输出）：
   - 即使当前无明确入场信号，也要输出"关注价位"
   - 格式：`watch_levels: [{ price: 价格, direction: "long"/"short", trigger: "突破/回踩/跌破", reason: "理由" }]`
   - 基于 structure_candidates 的支撑/阻力位给出 2-3 个关注价位
   - 示例：
     - 若价格接近支撑且指标超卖 → "关注 95000 回踩确认后做多"
     - 若价格接近阻力且动能减弱 → "关注 98000 突破失败做空"
   - 必须给出，不允许只输出 hold 而不提供任何关注位

8) OTC API 数据：
{{ .OTCData }}
{{ .ExitPlanSchema }}
