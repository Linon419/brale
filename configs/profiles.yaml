# profiles.yaml：运行配置（币种/周期/指标中间件/prompt/exit_plan 组合）
# 图表与指标窗口说明（重要）：
# - analysis_slice：图表/CSV 显示的最近 N 根K线窗口（越小图越稀疏）。
# - slice_drop_tail：再丢弃最新 N 根（常用于避开未收线K线）。
# - 实际图表窗口 = analysis_slice - slice_drop_tail（若 >0）；指标计算不受 analysis_slice 影响。
# - EMA/MACD/RSI 由历史K线计算，历史长度上限由 kline_fetcher.limit 与 kline.max_cached 决定。
# - EMA200 要让整张图表不留空白：历史根数 >= (图表窗口 + 199)。
# - MACD 要让整张图表不留空白：历史根数 >= (图表窗口 + (slow + signal - 1))。
# - 示例：analysis_slice=100, slice_drop_tail=1 -> 图表窗口=99；
#   EMA200 需 >= 99+199=298 根历史；MACD(12/26/9) 需 >= 99+34=133 根历史。
# - 若图表出现空白：降低 analysis_slice，或提高 kline_fetcher.limit 与 config.yaml 的 kline.max_cached。
# 结构说明：
# - profiles: 下每个 key 是一个 profile 名称（可自定义）
# - 每个 profile 可绑定多个 targets（币种），并配置订阅周期、决策频率、指标中间件等
# - prompts 用于按模型选择 system prompt（system_by_model）以及统一的 user prompt
# - exit_plans.combos 用于限定可用的 exit_plan 组件组合（实际模板在 ai.exit_plan_path 指向的目录）

profiles:
  eth_plan_combo:
    context_tag: "OTC 分阶段策略"
    targets: ["BTC/USDT", "ETH/USDT", "BNB/USDT", "SOL/USDT", "DOGE/USDT", "LTC/USDT", "LDO/USDT", "CRV/USDT", "LINK/USDT", "ADA/USDT", "UNI/USDT", "ONDO/USDT", "AAVE/USDT", "AVAX/USDT", "1000PEPE/USDT", "SUI/USDT", "SEI/USDT", "WLD/USDT", "HYPE/USDT", "TRUMP/USDT", "PUMP/USDT", "ZEC/USDT"]
    targets_api_url: "http://168.138.207.11:3080/api/public/top-otc-crypto"
    targets_api_override: true
    targets_api_quote: "USDT"
    targets_api_timeout_seconds: 8
    targets_api_refresh_seconds: 3600
    intervals: ["15m", "1h"]
    decision_interval_multiple: 1
    analysis_slice: 100
    slice_drop_tail: 1
    middlewares:
      - name: kline_fetcher
        stage: 0
        critical: true
        timeout_seconds: 5
        params:
          intervals: ["15m", "1h", "1d"]   # 添加1d用于ATR杠杆计算
          limit: 300
      - name: ema_trend
        stage: 1
        configs:
          "15m": { fast: 21, mid: 55, slow: 100, long: 200 }
          "1h":  { fast: 21, mid: 55, slow: 100, long: 200 }
      - name: macd_trend
        stage: 1
        configs:
          "15m": { fast: 12, slow: 26, signal: 9 }
          "1h":  { fast: 12, slow: 26, signal: 9 }
      - name: wt_mfi_hybrid
        stage: 1
        configs:
          "15m": { overbought: 53, oversold: -53 }
          "1h":  { overbought: 53, oversold: -53 }
    prompts:
      user: "hedge_trend.txt"
      system_by_model:
        claude: "system-indicator-hedge.txt"
        deepseek: "system-mechanics.txt"
        gemini: "system-structure.txt"
    derivatives:
      enabled: true
      include_oi: true
      include_funding: true
    leverage:
      enabled: true
      max: 35
      # ATR-based leverage calculation (以损订仓)
      atr_enabled: true                        # 启用基于ATR的杠杆计算: leverage = close / max_atr_24h
      atr_period: 14                           # ATR计算周期 (默认: 14)
      atr_timeframe: "1d"                      # 使用日线ATR计算杠杆
      stop_loss_risk_pct: 5.0                  # 单笔交易风险比例 (占总资金的百分比，默认: 5%)
    exit_plans:
      combos: ["tp_tiers__sl_single"]
